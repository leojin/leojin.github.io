<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on LeoJin</title>
    <link>/posts/</link>
    <description>Recent content in Posts on LeoJin</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Thu, 26 Dec 2024 00:05:36 +0800</lastBuildDate><atom:link href="/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>2024 12 26 Google Oauth</title>
      <link>/posts/2024-12-26-google-oauth/</link>
      <pubDate>Thu, 26 Dec 2024 00:05:36 +0800</pubDate>
      
      <guid>/posts/2024-12-26-google-oauth/</guid>
      <description>&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;h1 id=&#34;一准备&#34;&gt;一、准备&lt;/h1&gt;
&lt;h2 id=&#34;1google-console-search&#34;&gt;1、Google Console Search&lt;/h2&gt;
&lt;p&gt;证明网站所有权，以使用Google Oauth Client发布到生产环境。
&lt;a href=&#34;https://search.google.com/search-console&#34;&gt;申请入口&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;2google-oauth-client&#34;&gt;2、Google Oauth Client&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://developers.google.com/identity/protocols/oauth2&#34;&gt;官方文档&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;申请入口：&lt;a href=&#34;https://console.cloud.google.com/&#34;&gt;Google Cloud Platform&lt;/a&gt;，进入&lt;code&gt;APIs &amp;amp; Services&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;左侧导航栏选择&lt;code&gt;Credentials&lt;/code&gt;，点击&lt;code&gt;Create credentials&lt;/code&gt;，选择&lt;code&gt;OAuth client ID&lt;/code&gt;。
&lt;ul&gt;
&lt;li&gt;User Type选择&lt;code&gt;External&lt;/code&gt;（对外公开网站，允许任意用户登录）&lt;/li&gt;
&lt;li&gt;Application Type，这里选择&lt;code&gt;Web application&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;流程完成后，获取到&lt;code&gt;Client ID&lt;/code&gt;和&lt;code&gt;Client Secret&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;二登录流程示意&#34;&gt;二、登录流程示意&lt;/h1&gt;
&lt;p&gt;&lt;img alt=&#34;流程示意&#34; src=&#34;/posts/2024-12-26-google-oauth/images/login-google.png&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;1-前端sdk接入&#34;&gt;1、 前端SDK接入&lt;/h2&gt;
&lt;p&gt;&lt;img alt=&#34;登录按钮&#34; src=&#34;/posts/2024-12-26-google-oauth/images/login-google-button.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;接入上述按钮，参考：&lt;a href=&#34;https://www.npmjs.com/package/@react-oauth/google&#34;&gt;@react-oauth/google&lt;/a&gt;，过程中需要传入&lt;code&gt;Client ID&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-jsx&#34; data-lang=&#34;jsx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;import&lt;/span&gt; {&lt;span style=&#34;color:#a6e22e&#34;&gt;GoogleOAuthProvider&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;GoogleLogin&lt;/span&gt;} &lt;span style=&#34;color:#a6e22e&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;@react-oauth/google&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GoogleLoginComponent&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; () =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onSuccess&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;) =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;console&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;GoogleOAuthProvider&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Your Oauth ClientID&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;GoogleLogin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#a6e22e&#34;&gt;onSuccess&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;onSuccess&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            /&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &amp;lt;/&lt;span style=&#34;color:#f92672&#34;&gt;GoogleOAuthProvider&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    );
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-服务端登录接口主要逻辑&#34;&gt;2、 服务端登录接口主要逻辑&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;请求&lt;code&gt;https://oauth2.googleapis.com/tokeninfo&lt;/code&gt;, 通过前端传入的&lt;code&gt;Credential&lt;/code&gt;，获取用户基本信息，其中sub可作为谷歌用户ID，见&lt;a href=&#34;https://cloud.google.com/docs/authentication/token-types?hl=zh-cn#id&#34;&gt;官方说明&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;根据sub，查询用户（触发新老用户逻辑）。&lt;/li&gt;
&lt;li&gt;处理Session，返回业务登录凭据。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;三开发发布&#34;&gt;三、开发&amp;amp;发布&lt;/h1&gt;
&lt;h2 id=&#34;1-开发测试&#34;&gt;1、 开发测试&lt;/h2&gt;
&lt;p&gt;在&lt;a href=&#34;https://console.cloud.google.com/auth/clients&#34;&gt;Google Auth Platform/Client ID for Web application&lt;/a&gt;中修改&lt;code&gt;Authorized JavaScript origins&lt;/code&gt;，填写本地开发环境和测试环境的地址（支持http://127.0.0.1:xxxx）&lt;/p&gt;</description>
      <content>&lt;h1 id=&#34;heading&#34;&gt;&lt;/h1&gt;
&lt;h1 id=&#34;一准备&#34;&gt;一、准备&lt;/h1&gt;
&lt;h2 id=&#34;1google-console-search&#34;&gt;1、Google Console Search&lt;/h2&gt;
&lt;p&gt;证明网站所有权，以使用Google Oauth Client发布到生产环境。
&lt;a href=&#34;https://search.google.com/search-console&#34;&gt;申请入口&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;2google-oauth-client&#34;&gt;2、Google Oauth Client&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://developers.google.com/identity/protocols/oauth2&#34;&gt;官方文档&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;申请入口：&lt;a href=&#34;https://console.cloud.google.com/&#34;&gt;Google Cloud Platform&lt;/a&gt;，进入&lt;code&gt;APIs &amp;amp; Services&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;左侧导航栏选择&lt;code&gt;Credentials&lt;/code&gt;，点击&lt;code&gt;Create credentials&lt;/code&gt;，选择&lt;code&gt;OAuth client ID&lt;/code&gt;。
&lt;ul&gt;
&lt;li&gt;User Type选择&lt;code&gt;External&lt;/code&gt;（对外公开网站，允许任意用户登录）&lt;/li&gt;
&lt;li&gt;Application Type，这里选择&lt;code&gt;Web application&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;流程完成后，获取到&lt;code&gt;Client ID&lt;/code&gt;和&lt;code&gt;Client Secret&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;二登录流程示意&#34;&gt;二、登录流程示意&lt;/h1&gt;
&lt;p&gt;&lt;img alt=&#34;流程示意&#34; src=&#34;/posts/2024-12-26-google-oauth/images/login-google.png&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;1-前端sdk接入&#34;&gt;1、 前端SDK接入&lt;/h2&gt;
&lt;p&gt;&lt;img alt=&#34;登录按钮&#34; src=&#34;/posts/2024-12-26-google-oauth/images/login-google-button.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;接入上述按钮，参考：&lt;a href=&#34;https://www.npmjs.com/package/@react-oauth/google&#34;&gt;@react-oauth/google&lt;/a&gt;，过程中需要传入&lt;code&gt;Client ID&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-jsx&#34; data-lang=&#34;jsx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;import&lt;/span&gt; {&lt;span style=&#34;color:#a6e22e&#34;&gt;GoogleOAuthProvider&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;GoogleLogin&lt;/span&gt;} &lt;span style=&#34;color:#a6e22e&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;@react-oauth/google&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GoogleLoginComponent&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; () =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onSuccess&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;async&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;) =&amp;gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;console&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;response&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;GoogleOAuthProvider&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;clientId&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Your Oauth ClientID&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;GoogleLogin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#a6e22e&#34;&gt;onSuccess&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;onSuccess&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            /&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &amp;lt;/&lt;span style=&#34;color:#f92672&#34;&gt;GoogleOAuthProvider&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    );
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;2-服务端登录接口主要逻辑&#34;&gt;2、 服务端登录接口主要逻辑&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;请求&lt;code&gt;https://oauth2.googleapis.com/tokeninfo&lt;/code&gt;, 通过前端传入的&lt;code&gt;Credential&lt;/code&gt;，获取用户基本信息，其中sub可作为谷歌用户ID，见&lt;a href=&#34;https://cloud.google.com/docs/authentication/token-types?hl=zh-cn#id&#34;&gt;官方说明&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;根据sub，查询用户（触发新老用户逻辑）。&lt;/li&gt;
&lt;li&gt;处理Session，返回业务登录凭据。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;三开发发布&#34;&gt;三、开发&amp;amp;发布&lt;/h1&gt;
&lt;h2 id=&#34;1-开发测试&#34;&gt;1、 开发测试&lt;/h2&gt;
&lt;p&gt;在&lt;a href=&#34;https://console.cloud.google.com/auth/clients&#34;&gt;Google Auth Platform/Client ID for Web application&lt;/a&gt;中修改&lt;code&gt;Authorized JavaScript origins&lt;/code&gt;，填写本地开发环境和测试环境的地址（支持http://127.0.0.1:xxxx）&lt;/p&gt;
&lt;h2 id=&#34;2-发布正式&#34;&gt;2、 发布正式&lt;/h2&gt;
&lt;p&gt;在&lt;a href=&#34;https://console.cloud.google.com/auth/audience&#34;&gt;Google Auth Platform/Audience&lt;/a&gt;中，切换到&lt;code&gt;Production&lt;/code&gt;，提交审核，审核通过后即可上线使用。
审核期间如有问题，会有邮件通知（体验很快，1天内就给了反馈），根据邮件提示修改即可。&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>2024 11</title>
      <link>/posts/2024-11/</link>
      <pubDate>Wed, 06 Nov 2024 02:10:25 +0800</pubDate>
      
      <guid>/posts/2024-11/</guid>
      <description>&lt;p&gt;脑子里有个Idea很宏伟，想去实现它。&lt;/p&gt;</description>
      <content>&lt;p&gt;脑子里有个Idea很宏伟，想去实现它。&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>2024 04</title>
      <link>/posts/2024-04/</link>
      <pubDate>Wed, 09 Oct 2024 22:28:07 +0800</pubDate>
      
      <guid>/posts/2024-04/</guid>
      <description>&lt;p&gt;丽水&lt;/p&gt;</description>
      <content>&lt;p&gt;丽水&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>2024 03</title>
      <link>/posts/2024-03/</link>
      <pubDate>Sat, 02 Mar 2024 23:15:14 +0800</pubDate>
      
      <guid>/posts/2024-03/</guid>
      <description>&lt;p&gt;夏夏&lt;/p&gt;</description>
      <content>&lt;p&gt;夏夏&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Hello World</title>
      <link>/posts/hello-world/</link>
      <pubDate>Sun, 25 Jun 2023 01:14:27 +0800</pubDate>
      
      <guid>/posts/hello-world/</guid>
      <description>&lt;p&gt;Bye WordPress.&lt;/p&gt;
&lt;p&gt;Hello Hugo &amp;amp; Github.io.&lt;/p&gt;</description>
      <content>&lt;p&gt;Bye WordPress.&lt;/p&gt;
&lt;p&gt;Hello Hugo &amp;amp; Github.io.&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
